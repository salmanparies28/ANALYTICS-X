<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <h2 class="text-2xl font-bold mb-6 text-center">Create an account</h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flex items-center p-4 mb-4 text-sm text-{{ 'green-800 bg-green-50 dark:bg-gray-800 dark:text-green-400' if category == 'success' else 'red-800 bg-red-50 dark:bg-gray-800 dark:text-red-400' }} rounded-lg" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 mr-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5  0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">{{ category.title() }} alert!</span> {{ message }}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form id="registerForm" action="/register" method="post" onsubmit="return validateForm(event)">
            <!-- Existing Fields -->
            <div class="mb-4">
                <label for="name" class="block text-gray-700">Name</label>
                <input type="text" id="name" name="name" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
            </div>
            <div class="mb-4">
                <label for="email" class="block text-gray-700">Email</label>
                <input type="email" id="email" name="email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
            </div>
            <div class="mb-4">
                <label for="password" class="block text-gray-700">Password</label>
                <input type="password" id="password" name="password" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
            </div>
            <div class="mb-4">
                <label for="phone" class="block text-gray-700">Phone</label>
                <input type="tel" id="phone" name="phone" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                <p id="phoneError" class="text-red-600 text-sm hidden mt-1">Please enter a valid 10-digit phone number.</p>
            </div>

            <div class="mb-4">
                <label for="company_size" class="block text-gray-700">Company Size</label>
                <select id="company_size" name="company_size" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                    <option value="" disabled selected>Select Company Size</option>
                    <option value="justme">Just me</option>
                    <option value="1-10">1-10</option>
                    <option value="11-50">11-50</option>
                    <option value="50-100">50-100</option>
                    <option value="100-200">100-200</option>
                    <option value="more">More</option>
                </select>
            </div>
            <div class="flex items-center mb-4">
                <input type="checkbox" id="terms" name="terms" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" required>
                <label for="terms" class="ml-2 block text-gray-700">I accept the <a href="#" onclick="openModal(event)" class="text-indigo-600 hover:text-indigo-800">Terms and Conditions</a></label>
            </div>
            <button type="submit" class="w-full bg-indigo-400 text-white py-2 px-4 rounded-md hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Create an account</button>
            <p class="mt-4 text-center text-gray-600">Already have an account? <a href="/login" class="text-indigo-600 hover:text-indigo-800">Login here</a></p>
        </form>
    </div>

    <!-- Shop Details Modal -->
    <div id="shopDetailsModal" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-75 hidden">
        <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-2xl relative overflow-y-auto" style="max-height: 80%;">
            <h2 class="text-2xl font-bold mb-6 text-center">Enter Shop Details</h2>
            <form id="shopDetailsForm">
                <div class="mb-4">
                    <label for="shop_name" class="block text-gray-700">Shop Name</label>
                    <input type="text" id="shop_name" name="shop_name" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="flatno" class="block text-gray-700">Flat No</label>
                    <input type="text" id="flatno" name="flatno" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="street" class="block text-gray-700">Street</label>
                    <input type="text" id="street" name="street" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="pincode" class="block text-gray-700">Pincode</label>
                    <input type="text" id="pincode" name="pincode" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" onchange="fetchPincodeDetails()" required>
                </div>
                <div class="mb-4">
                    <label for="city" class="block text-gray-700">City</label>
                    <input type="text" id="city" name="city" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" readonly required>
                </div>
                <div class="mb-4">
                    <label for="district" class="block text-gray-700">District</label>
                    <input type="text" id="district" name="district" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" readonly required>
                </div>
                <div class="mb-4">
                    <label for="state" class="block text-gray-700">State</label>
                    <input type="text" id="state" name="state" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" readonly required>
                </div>
                <div class="mb-4">
                    <label for="country" class="block text-gray-700">Country</label>
                    <input type="text" id="country" name="country" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" readonly required>
                </div>
                <div class="mb-4">
                    <label for="mobile_number" class="block text-gray-700">Mobile Number</label>
                    <input type="tel" id="mobile_number" name="mobile_number" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                    <p id="mobileNumberError" class="text-red-600 text-sm hidden mt-1">Please enter a valid 10-digit mobile number.</p>
                </div>
                <div class="mb-4">
                    <label for="landline_number" class="block text-gray-700">Landline Number (Optional)</label>
                    <input type="text" id="landline_number" name="landline_number" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="mb-4">
                    <label for="website_address" class="block text-gray-700">Website Address (Optional)</label>
                    <input type="text" id="website_address" name="website_address" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="mb-4">
                    <label for="gst_number" class="block text-gray-700">GST Number (Optional)</label>
                    <input type="text" id="gst_number" name="gst_number" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="submitShopDetails()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Terms and Conditions Modal -->
    <div id="termsModal" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-75 hidden">
        <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-2xl relative overflow-y-auto" style="max-height: 80%;">
            <h1 class="text-3xl font-bold mb-6 text-center">Terms and Conditions</h1>
            <div class="text-gray-700 mb-4">
                <!-- Terms and Conditions Content -->
                <p>Welcome to ANALYTICS-X. These terms and conditions outline the rules and regulations for the use of our software.</p>
                <p>By accessing this software, we assume you accept these terms and conditions. Do not continue to use the software if you do not agree to all of the terms and conditions stated on this page.</p>
                <h2 class="text-xl font-semibold mt-4">1. License</h2>
                <p>We grant you a non-exclusive, non-transferable, limited license to download, install, and use the Software strictly in accordance with these Terms. This license is for your personal or business use only and does not grant you any rights to modify, distribute, or sell the Software.</p>
                <h2 class="text-xl font-semibold mt-4">2. User Accounts</h2>
                <p>To use certain features of the Software, you may be required to create an account. You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account. You must notify us immediately if you suspect any unauthorized use of your account.</p>
                <h2 class="text-xl font-semibold mt-4">3. Acceptable Use</h2>
                <p>You agree not to use the Software in any way that</p>
                <p>Violates any applicable laws or regulations</p>
                <p>on the rights of any third party;</p> 
                <p>Is harmful, fraudulent, or misleading;</p>
                <p>Disrupts the operation of the Software or servers;</p>
                <p>to gain unauthorized access to any part of the Software.</p> 
                   
                <h2 class="text-xl font-semibold mt-4">4. Payments and Subscriptions</h2>
                <p>If the Software requires a payment or subscription, you agree to provide accurate and complete payment information. You authorize us to charge all fees incurred through your account to the payment method you have provided.</p>
                <h2 class="text-xl font-semibold mt-4">5. Intellectual Property </h2>
                 <p>All intellectual property rights in the Software and its contents are owned by us or our licensors. You agree not to reproduce, distribute, or create derivative works of the Software without our explicit permission.</p>
                 <h2 class="text-xl font-semibold mt-4">6. Data Privacy</h2>
                 <p>Your privacy is important to us. Please review our Privacy Policy [insert link to Privacy Policy] to understand how we collect, use, and protect your personal information.</p>
                 <h2 class="text-xl font-semibold mt-4">7. Termination</h2>
                 <p>We reserve the right to terminate or suspend your access to the Software at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to us or other users. Upon termination, your right to use the Software will immediately cease.</p>
                 <h2 class="text-xl font-semibold mt-4">8. Limitation of Liability</h2>
                 <p>To the fullest extent permitted by law, in no event will we be liable for any indirect, incidental, special, consequential, or punitive damages, including, without limitation, loss of profits, data, use, goodwill, or other intangible losses, arising out of or in connection with your use of the Software.</p>
                 <h2 class="text-xl font-semibold mt-4">9. Governing Law</h2>
                 <p>These Terms will be governed by and construed in accordance with the laws of [Your Jurisdiction], without regard to its conflict of law provisions. Any disputes arising under these Terms will be subject to the exclusive jurisdiction of the courts of [Your Jurisdiction].</p>
                 <h2 class="text-xl font-semibold mt-4">10. Changes to Terms</h2>
                 <p>We reserve the right to modify or replace these Terms at any time. If a revision is material, we will provide at least 30 days' notice before any new terms take effect. Your continued use of the Software after any changes constitutes your acceptance of the new Terms.</p>
            </div>
            <div class="flex justify-end">
                <button onclick="closeModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Close</button>
            </div>
        </div>
    </div>

    <script>
        function validateForm(event) {
            event.preventDefault();
            
            const terms = document.getElementById('terms');
            if (!terms.checked) {
                alert('Please accept the Terms and Conditions to proceed.');
                return false;
            }

            const phone = document.getElementById('phone').value;
            const phoneError = document.getElementById('phoneError');

            if (!/^\d{10}$/.test(phone)) {
                phoneError.classList.remove('hidden');
                return false;
            } else {
                phoneError.classList.add('hidden');
            }

            // Show shop details modal after main form validation
            showShopDetailsModal(event);
        }

        function openModal(event) {
            event.preventDefault();
            const modal = document.getElementById('termsModal');
            modal.classList.remove('hidden');
            modal.addEventListener('click', handleOutsideClick);
        }

        function closeModal() {
            const modal = document.getElementById('termsModal');
            modal.classList.add('hidden');
            modal.removeEventListener('click', handleOutsideClick);
        }

        function handleOutsideClick(event) {
            if (event.target === event.currentTarget) {
                closeModal();
            }
        }

        function showShopDetailsModal(event) {
            const modal = document.getElementById('shopDetailsModal');
            modal.classList.remove('hidden');
        }

        function fetchPincodeDetails() {
            const pincode = document.getElementById('pincode').value;
            fetch(`/fetch-pincode-details?pincode=${pincode}`)
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        document.getElementById('city').value = data.city;
                        document.getElementById('district').value = data.district;
                        document.getElementById('state').value = data.state;
                        document.getElementById('country').value = data.country;
                    }
                });
        }

        function submitShopDetails() {
            const shopDetailsForm = document.getElementById('shopDetailsForm');
            const mobileNumber = document.getElementById('mobile_number').value;
            const mobileNumberError = document.getElementById('mobileNumberError');

            if (!/^\d{10}$/.test(mobileNumber)) {
                mobileNumberError.classList.remove('hidden');
                return false;
            } else {
                mobileNumberError.classList.add('hidden');
            }

            if (!shopDetailsForm.checkValidity()) {
                alert('Please fill out all required shop details.');
                return;
            }

            const modal = document.getElementById('shopDetailsModal');
            const form = document.getElementById('registerForm');
            
            const shopDetails = new FormData(shopDetailsForm);
            shopDetails.forEach((value, key) => {
                let input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                form.appendChild(input);
            });

            modal.classList.add('hidden');
            form.submit();
        }
    </script>
</body>
</html>
